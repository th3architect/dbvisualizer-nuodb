<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE DatabaseProfile SYSTEM "dbvis-defs.dtd" [
        <!ENTITY generic-commands SYSTEM "generic-commands.xml">
        <!ENTITY generic-view SYSTEM "generic-view.xml">
        ]>

<!--
   Copyright (c) DbVis Software AB. All Rights Reserved.
-->

<DatabaseProfile
        desc="Profile for NuoDB"
        version="$Revision: $"
        date="$Date: $"
        minver="7.1">

    <!--
     Profile Notes
     =============
       None.

     Change Log
     ==========
       2012-07-17:
         - Created by Bob Buck
    -->

    <!-- =================================================================== -->
    <!-- Definition of the commands -->
    <!-- =================================================================== -->

    <Commands>

        &generic-commands;

        <!--
          The "getTableNamesFor" command is used by Database getTableNamesFor().
          It must return table names for the schema named by ${table_schema}
          variables in the first column.
        -->
        <Command id="nuodb.getTableNamesFor">
            <SQL>
                <![CDATA[
select table_name
from system.tables
where table_schem = '${table_schema}'
order by table_name
            ]]>
            </SQL>
        </Command>

        <!--
          The "getColumnNamesFor" command is used by Database getColumnNamesFor().
          It must return column names for the catalog, schema and table named by
          the ${table_catalog}, ${table_catalog} and ${table_name} variables in
          the first column.
        -->
        <Command id="nuodb.getColumnNamesFor">
            <SQL>
                <![CDATA[
select column_name
from system.tables
where table_schem = '${table_schema}'
and table_name = '${table_name}'
order by column_name
            ]]>
            </SQL>
        </Command>

        <Command id="nuodb.getTables">
            <SQL>
                <![CDATA[
select * from system.tables where schema != 'system'
            ]]>
            </SQL>
        </Command>

        <Command id="nuodb.getTable">
            <SQL>
                <![CDATA[
select * from system.tables where tablename = '${table}'
            ]]>
            </SQL>
        </Command>

        <!-- ================================================================= -->
        <!-- DBA related commands requiring certain privileges in the database -->
        <!-- ================================================================= -->

        <Command id="nuodb.getUsers">
            <SQL>
                <![CDATA[
select * from system.users
            ]]>
            </SQL>
        </Command>

        <Command id="nuodb.getRoles">
            <SQL>
                <![CDATA[
select * from system.roles
            ]]>
            </SQL>
        </Command>

        <Command id="nuodb.getSessions">
            <SQL>
                <![CDATA[
select * from system.connections
            ]]>
            </SQL>
        </Command>

    </Commands>

    <!-- =================================================================== -->
    <!-- Definition of the object actions that are used by the tree and views -->
    <!-- =================================================================== -->

    <ObjectsActionDef>
    </ObjectsActionDef>

    <!-- =================================================================== -->
    <!-- Definition of the database objects tree structure -->
    <!-- =================================================================== -->

    <ObjectsTreeDef id="nuodb">
        <GroupNode type="Databases">
        </GroupNode>

        <GroupNode type="DBA" label="DBA Views">

            <GroupNode type="Users" label="Users">
                <DataNode type="Login" label="${nuodb.getUsers.USERNAME}" isLeaf="true">
                    <SetVar name="objectname" value="${nuodb.getUsers.USERNAME}"/>
                    <Command idref="nuodb.getUsers">
                        <Output id="nuodb.getUsers.USERNAME" index="1"/>
                    </Command>

                </DataNode>
            </GroupNode>

        </GroupNode>
    </ObjectsTreeDef>

    <!-- =================================================================== -->
    <!-- Definition of the database objects views -->
    <!-- =================================================================== -->

    <!-- Include the generic-view -->
    &generic-view;

    <ObjectsViewDef id="nuodb" extends="generic">

        <!-- DBA views -->

        <ObjectView type="Users">
            <DataView type="Users" label="Users" viewer="grid">
                <Command idref="nuodb.getUsers"/>
            </DataView>
        </ObjectView>

    </ObjectsViewDef>

</DatabaseProfile>
